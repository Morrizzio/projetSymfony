{% extends 'base.html.twig' %}
{% block title %}{% endblock %}


{% block body %}
    {{ form_start(sortieForm) }}
    {{ form_widget(sortieForm) }}
    <label for="villes">Villes</label>
    <select id="villes" name="villes">
        {% for ville in villes %}
            <option value="{{ ville.id }}">{{ ville.nom }}</option>
        {% endfor %}</select>
    <label for="lieux">Lieux</label>
    <select id="lieux" name="lieux">
    </select>


    <img src="add.png"/>
    <p id="rue">
        Rue : <strong></strong>
    </p>
    <p id="cp">
        Code Postal : <strong></strong>
    </p>
    <p id="latitude">
        Latitude : <strong></strong>
    </p>
    <p id="longitude">
        Longitude : <strong></strong>
    </p>

    <input type="submit" value="valider">
    {{ form_end(sortieForm) }}
{% endblock %}

{% block scripts %}
    <script>
       var id_ville;
        $( document ).ready(function() {
            let id_ville=1;
            let id_lieu;
            let dataResp;


                $.ajax({
                    method: "POST",
                    url: "{{ path('sortie_recherche_ajax') }}",
                    data: {id: id_ville},
                    dataType: 'JSON',
                    success: function(data){
                        dataResp = (JSON.parse(data));
                        $("#lieux").empty();
                        for (let i of dataResp){
                            console.log(i.nom);
                            $optionLieu= $('<option value="'+ i.id +'">'+ i.nom + '</option>');
                            $("#lieux").append($optionLieu);
                        }
                        $("#rue>strong").text(dataResp[0].rue);
                        $("#cp>strong").text(dataResp[0].ville.codePostal);
                        $("#latitude>strong").text(dataResp[0].latitude);
                        $("#longitude>strong").text(dataResp[0].longitude);
                    }
                });

            $("#villes").change(function() {
                id_ville= $(this).val();
                $.ajax({
                    method: "POST",
                    url: "{{ path('sortie_recherche_ajax') }}",
                    data: {id: id_ville},
                    dataType: 'JSON',
                    success: function(data){
                        dataResp = (JSON.parse(data));
                        $("#lieux").empty();
                        for (let i of dataResp){
                            console.log(i.nom);
                            $optionLieu= $('<option value="'+ i.id +'">'+ i.nom + '</option>');
                            $("#lieux").append($optionLieu);
                        }
                        $("#rue>strong").text(dataResp[0].rue);
                        $("#cp>strong").text(dataResp[0].ville.codePostal);
                        $("#latitude>strong").text(dataResp[0].latitude);
                        $("#longitude>strong").text(dataResp[0].longitude);
                    }
                });
            });
            $("#lieux").change(function() {
                id_lieu = $(this).val();
                for (let lieu of dataResp){
                    if (lieu.id == id_lieu){
                        console.log(lieu);
                        $("#rue>strong").text(lieu.rue);
                        $("#cp>strong").text(lieu.ville.codePostal);
                        $("#latitude>strong").text(lieu.latitude);
                        $("#longitude>strong").text(lieu.longitude);
                    }

                }


            });
        });

    </script>

{% endblock %}









